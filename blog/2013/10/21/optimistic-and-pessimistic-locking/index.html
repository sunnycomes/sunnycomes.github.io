
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Optimistic and Pessimistic Locking - I/O VIsion</title>
  <meta name="author" content="Sunny">

  
  <meta name="description" content="Locking Introduction This article talks about serveral ways of doing locking. It starts with concurrency problems and then discusses about 2 ways of &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://www.iovi.com/blog/2013/10/21/optimistic-and-pessimistic-locking">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="I/O VIsion" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-43860851-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://' : 'http://') + 'stats.g.doubleclick.net/dc.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-43860851-1', 'iovi.com');
  ga('send', 'pageview');

</script>




</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">I/O VIsion</a></h1>
  
    <h2>Do one thing at a time, and do well.</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:www.iovi.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">


<li><a href="/">Home</a></li>

<li><a href="/blog/archives">Archives</a></li>

<li><a href="/blog/categories/stuff">Stuff</a></li>

<li><a href="/bookshelf">Bookshelf</a></li>

<!--
	<li><a href="/blog/stuff">Stuff</a></li>

	Commented out for present.
<li><a href="/blog/categories/data-mining">Data Mining</a></li>

<li><a href="/blog/bookrack ">Bookrack</a></li>

-->
<li><a href="/about ">About</a></li>


</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Optimistic and Pessimistic Locking</h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-10-21T21:40:48+08:00" pubdate data-updated="true">Oct 21<span>st</span>, 2013</time>
        
           | <a href="#disqus_thread"
             data-disqus-identifier="http://www.iovi.com">Comments</a>
        
      </p>
    
  </header>


<div class="entry-content"><h2>Locking Introduction</h2>

<p>This article talks about serveral ways of doing locking. It starts with concurrency problems and then discusses about 2 ways of doing optimistic locking. As optimistic locking does not solve the concurrency issues from roots, it introduces pessimistic locking. It then moves ahead to explain how isolation levels can help us implement pessimistic locking. Each isolation level is explained with sample demonstration to make concepts clearer.</p>

<h2>Why do we need locking?</h2>

<p>In multi-user environment it&rsquo;s possible that multiple users can update the same record at the same time causing confusion between users. This issue is termed as concurrency.</p>

<!-- more -->


<h2>How can we solve concurrency problems?</h2>

<p>Concurrency problems can be solved by implementing proper &ldquo;Locking strategy&rdquo;. Locks prevent action on a resource to be performed when some other resource is already performing some action on it.</p>

<h2>Optimistic Locking</h2>

<p>As the name suggests &ldquo;optimistic&rdquo; it assumes that multiple transaction will work without affecting each other. In other words no locks are enforced while doing optimistic locking. The transaction just verifies that no other transaction has modified the data. In case of modification the transaction is rolled back.</p>

<h3>How does optimistic lock work?</h3>

<p>You can implement optimistic locking by numerous ways but the fundamental to implement optimistic locking remains same. It&rsquo;s a 4 step process as shown below:</p>

<ol>
<li>Record the current timestamp.</li>
<li>Start changing the values.</li>
<li>Before updating check whether anyone else has changed the values by checking the old time stamp and new time stamp or the old value and the current value in database.</li>
<li>If it&rsquo;s not equal rollbacks or else commit.</li>
</ol>


<p><img src="/images/upload/optimistic_locking.jpg" alt="optimistic_locking" /></p>

<pre><code>update tbl_items set itemname='itemname' where CurrentTimestamp='OldTimeStamp'

update tbl_items set itemname=@itemname where itemname=@OldItemNameValue
</code></pre>

<h2>Pessimistic Locking</h2>

<p>But it looks like by using optimistic locking concurrency problems are not really solved?Yes, you said right. By using optimistic locking you only detect the concurrency problem. To solve concurrency issues from the roots itself we need to use pessimistic locking. Optimistic is like prevention while pessimistic locking is actually the cure.
Pessimistic locking assumes that concurrency/collision issues will happen so a lock is placed on the records and then data is updated.</p>

<h3>How can we do pessimistic locking?</h3>

<p>We can do pessimistic locking by specifying &ldquo;IsolationLevel&rdquo; in SQL Server stored procedures, ADO.NET level or by using transaction scope object, in java the JDBC Connection.</p>

<h3>What kind of locks can be acquired by using pessimistic locking?</h3>

<p>There are 4 kinds of locks you can acquire Shared, Exclusive, Update and intent. The first two are actual locks while the other two are hybrid locks and marker. Correspondingly, in SQL there are 4 kinds of transaction isolation level, below is a simple table which shows when to use them and what locks they put.</p>

<table>
<thead>
<tr>
<th align="center">Isolation Level      </th>
<th align="center">  Read                    </th>
<th align="center">Update     </th>
<th align="center">Insert</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">Read Uncommitted     </td>
<td align="center">  Reads data which is yet not committed.  </td>
<td align="center">Allowed    </td>
<td align="center">Allowed</td>
</tr>
<tr>
<td align="center">Read Committed ( Default)</td>
<td align="center">  Reads data which is committed.      </td>
<td align="center">Allowed    </td>
<td align="center">Allowed</td>
</tr>
<tr>
<td align="center">Repeatable Read      </td>
<td align="center">  Reads data which is committed.      </td>
<td align="center">Not Allowed    </td>
<td align="center">Allowed</td>
</tr>
<tr>
<td align="center">Serializable         </td>
<td align="center">  Reads data which is committed.      </td>
<td align="center">Not Allowed    </td>
<td align="center">Not Allowed</td>
</tr>
</tbody>
</table>


<p>More details are covered in this post<a href="/blog/2013/10/11/optimal-isolation-level/">Optimal Isolation Level</a>;</p>

<h2>References:</h2>

<p><a href="http://www.codeproject.com/Articles/114262/6-ways-of-doing-locking-in-NET-Pessimistic-and-opt#Solution%20number%202:-%20Use%20timestamp%20data%20type">6 ways of doing locking in .NET (Pessimistic and optimistic)</a></p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Sunny</span></span>

      








  


<time datetime="2013-10-21T21:40:48+08:00" pubdate data-updated="true">Oct 21<span>st</span>, 2013</time>
      


    </p>
    
      <div class="sharing">
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2013/10/11/simple-guide-for-markdown/" title="Previous Post: Simple Guide for Markdown">&laquo; Simple Guide for Markdown</a>
      
      
        <a class="basic-alignment right" href="/blog/2013/10/31/optimal-isolation-level/" title="Next Post: Optimal JDBC Transaction Isolation Level">Optimal JDBC Transaction Isolation Level &raquo;</a>
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2014/04/01/flipping-coins-strategy-to-win/">抛硬币也能抛出人生大赢家</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/03/06/a-new-start/">脱离低级趣味的写作</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/03/01/talk-about-bitcoin-change/">聊一聊不一样的比特币找零机制</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/02/21/simple-git-guide/">Simple Git Guide</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/12/11/java-performance-tunning-tips/">Java Performance Tuning Tips</a>
      </li>
    
  </ul>
</section>
<section>
  <h1>Tags</h1>
  <ul class="tag-cloud">
    <a style="font-size: 90%" href="/tags/bitcoin/">Bitcoin</a>
<a style="font-size: 210%" href="/tags/database/">Database</a>
<a style="font-size: 90%" href="/tags/git/">Git</a>
<a style="font-size: 210%" href="/tags/java/">Java</a>
<a style="font-size: 210%" href="/tags/mysql/">MySQL</a>

  </ul>
</section>




  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2014 - Sunny -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'sunnycomes';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://www.iovi.com/blog/2013/10/21/optimistic-and-pessimistic-locking/';
        var disqus_url = 'http://www.iovi.com/blog/2013/10/21/optimistic-and-pessimistic-locking/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>











</body>
</html>
